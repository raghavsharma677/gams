"use strict";var _createClass=function(){function o(t,e){for(var i=0;i<e.length;i++){var o=e[i];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,o.key,o)}}return function(t,e,i){return e&&o(t.prototype,e),i&&o(t,i),t}}();function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}var WalkthroughNotification=function(){function e(t){_classCallCheck(this,e);this.config=function t(){for(var e={},i=0;i<arguments.length;i++)for(var o in arguments[i])arguments[i].hasOwnProperty(o)&&(e[o]=arguments[i][o].constructor===Object?t(e[o]||{},arguments[i][o]):arguments[i][o]);return e}({message:"Hey there! Do you need help? Let me show you the walkthrough.",calltoAction:"Show Walkthrough",alignment:"br",character:0,autoShow:!0,autoPlay:!1,wait:1e3,size:"normal",extraMargin:{right:0,left:0,top:0,bottom:0},colors:{default:"#36d686",hover:"#10cb6d"}},t),this.elements={page:document.querySelector("body"),wthVideo:null,wthVideoBtn:null,closeButton:null,notificationPopup:null,notificationContainer:null,pointtowalkthrough:null,animRepeater:null},this.showNotification=this.showNotification.bind(this),this.hideNotification=this.hideNotification.bind(this),this.scrollToWalkthrough=this.scrollToWalkthrough.bind(this),this.setup()}return _createClass(e,[{key:"setup",value:function(){var t=this,e=document.createElement("style");e.innerHTML="#showTubiaWalkthrough { background-color: "+this.config.colors.default+" !important;  } #showTubiaWalkthrough:hover,#showTubiaWalkthrough:active{ background-color: "+this.config.colors.hover+" !important;  } "+document.head.appendChild(e);var i=document.createElement("script");i.src="https://cdnjs.cloudflare.com/ajax/libs/bodymovin/5.5.9/lottie.min.js",document.head.appendChild(i);var o=document.querySelectorAll("iframe"),n=0;o.forEach(function(t){t.hasAttribute("src")&&-1<t.src.indexOf("player.tubia.com")&&t.setAttribute("tubia-walkthrough",!0),n++});var a=setInterval(function(){n===o.length&&(clearInterval(a),i.addEventListener("load",t.create.call(t)))},100)}},{key:"create",value:function(){var t=document.querySelectorAll("iframe[tubia-walkthrough=true]");if(t.length){this.elements.wthVideo=t[0]||t;this.elements.wthVideo.insertAdjacentHTML("beforebegin",'\n            <span id="pointtowalkthrough"></span>\n        '),this.elements.pointtowalkthrough=document.getElementById("pointtowalkthrough"),this.elements.notificationContainer=document.createElement("div"),this.elements.notificationContainer.setAttribute("id","tubiaWalkthroughNotification");var e="box hide "+this.config.alignment+" "+this.config.size;this.elements.notificationContainer.setAttribute("class",e),this.elements.notificationContainer.style.margin=this.config.extraMargin.top+"px "+this.config.extraMargin.right+"px "+this.config.extraMargin.bottom+"px "+this.config.extraMargin.left+"px";var i='\x3c!-- Tubia Walkthrough Notification --\x3e<div id="character-'+this.config.character+'" class="character-'+this.config.character+' character"></div><div class="container">';if(void 0!==this.config.message?i+="<p>"+this.config.message+"</p>":this.elements.notificationContainer.classList.add("no-message"),i+='<button id="showTubiaWalkthrough" type="text">'+this.config.calltoAction+"</button></div>",this.elements.notificationContainer.innerHTML=i,this.elements.closeButton=document.createElement("button"),this.elements.closeButton.setAttribute("id","closeButton"),this.elements.closeButton.addEventListener("click",this.hideNotification),this.elements.notificationContainer.appendChild(this.elements.closeButton),this.elements.page.appendChild(this.elements.notificationContainer),this.elements.wthVideoBtn=document.getElementById("showTubiaWalkthrough"),this.elements.notificationPopup=document.getElementById("tubiaWalkthroughNotification"),this.config.autoShow){var o=this;setTimeout(function(){o.showNotification()},this.config.wait)}if(void 0!==this.elements.wthVideoBtn&&null!==this.elements.wthVideoBtn?this.elements.wthVideoBtn.addEventListener("click",this.scrollToWalkthrough):console.error('Error! Make sure the page has a walkthrough caller button with the setting of "id:showTubiaWalkthrough".'),this.config.character)var n={container:document.getElementById("character-"+this.config.character),renderer:"svg",loop:!1,autoplay:!1,path:"https://cdn.tubia.com/media/animations/notification/char-anim-"+this.config.character+".json",autoLoadSegments:!1},a=(o=this,setInterval(function(){if("object"==typeof lottie){clearInterval(a);var t=lottie.loadAnimation(n);t.addEventListener("DOMLoaded",function(){setTimeout(function(){t.play()},300),o.elements.animRepeater=setInterval(function(){t.playSegments([11,56],!0)},1e4)})}},100))}else console.warn("Please, make sure the page has a Tubia Walkthrough video.")}},{key:"scrollToWalkthrough",value:function(){var t=this;void 0!==this.elements.pointtowalkthrough&&null!==this.elements.pointtowalkthrough?(this.elements.pointtowalkthrough.scrollIntoView(!0),this.config.autoPlay&&setTimeout(function(){t.elements.wthVideo.contentWindow.postMessage("startPlay","*")},100),setTimeout(function(){t.hideNotification()},100)):console.error('Error! Make sure the page has a walkthrough video with the setting of "id:tubiaWalkthroughVideo".')}},{key:"showNotification",value:function(){this.elements.notificationPopup.classList.remove("hide")}},{key:"hideNotification",value:function(){this.elements.notificationPopup.classList.add("hide"),clearInterval(this.elements.animRepeater)}}]),e}();
//# sourceMappingURL=walkthroughnotification.min.js.map